
# install polkit in chroot on any update to check for pam issues
pkgname=libtirpc
pkgver=1.0.1
pkgrel=4
pkgdesc="Transport Independent RPC library (SunRPC replacement)"
arch=('x86_64')
url="http://libtirpc.sourceforge.net/"
license=('BSD')
depends=('libgssglue')
backup=('etc/netconfig')
options=('!libtool')
source=("https://downloads.sourceforge.net/sourceforge/libtirpc/${pkgname}-${pkgver}.tar.bz2"
        'rwlock_unlocks.patch'
        'libtirpc.patch')
md5sums=('36ce1c0ff80863bb0839d54aa0b94014'
         '625729308df789bffe52c305af08b0d6'
         'c2aff9af82ac17cc718b3044ccb6ad2c')

build() {
  cd ${pkgname}-${pkgver}
  # https://sourceforge.net/p/libtirpc/mailman/message/34594076/
  patch -p1 -i ${srcdir}/rwlock_unlocks.patch
  # http://seclists.org/oss-sec/2017/q2/209
  # https://github.com/guidovranken/rpcbomb/
  patch -p1 -i ${srcdir}/libtirpc.patch
  
  ./configure --prefix=/usr --sysconf=/etc
  make
}

package() {
  cd ${pkgname}-${pkgver}
  make DESTDIR=${pkgdir} install
  
  install -D -m644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
