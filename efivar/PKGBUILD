
pkgname=efivar
_pkgname=vathpela-efivar
_commit=70e63d4
pkgver=0.15
pkgrel=1
pkgdesc="Library to manipulate EFI variables"
arch=('x86_64')
url="https://github.com/vathpela/efivar"
license=('LGPL2.1')
depends=('popt')
options=('zipman' 'docs' '!makeflags')
source=("https://github.com/vathpela/efivar/tarball/master/efivar-${pkgver}.tar.bz2")
md5sums=('1841a5a99ad8d2293354d3b4e97cb79b')

build() {
	cd "${srcdir}/${_pkgname}-${_commit}/"
	
	unset CFLAGS
	unset CPPFLAGS
	unset CXXFLAGS
	unset LDFLAGS
	unset MAKEFLAGS
	
	sed 's|-rpath=$(TOPDIR)/src/|-rpath=$(libdir)|g' -i "${srcdir}/${_pkgname}-${_commit}/src/test/Makefile" || true
	sed 's|-O0|-Os|g' -i "${srcdir}/efivar/Make.defaults" || true
	
	make libdir="/usr/lib/" bindir="/usr/bin/" mandir="/usr/share/man/" includedir="/usr/include/" V=1 -j1
	echo
}

package() {
	
	cd "${srcdir}/${_pkgname}-${_commit}/"
	
	make -j1 V=1 DESTDIR="${pkgdir}/" libdir="/usr/lib/" bindir="/usr/bin/" mandir="/usr/share/man/" includedir="/usr/include/" install
	echo
	
	install -d "${pkgdir}/usr/bin"
	install -D -m0755 "${srcdir}/${_pkgname}-${_commit}/src/test/tester" "${pkgdir}/usr/bin/efivar-tester"
}